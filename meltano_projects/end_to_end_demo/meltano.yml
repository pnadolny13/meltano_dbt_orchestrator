version: 1
default_environment: dev
send_anonymous_usage_stats: false
plugins:
  extractors:
  - name: tap-csv
    variant: meltanolabs
    pip_url: git+https://github.com/MeltanoLabs/tap-csv.git
  loaders:
  - name: target-postgres
    variant: transferwise
    pip_url: pipelinewise-target-postgres
  transformers:
  - name: dbt-postgres
    pip_url: dbt-core~=1.0.0 dbt-postgres~=1.0.0
  utilities:
  - name: superset
    namespace: superset
    pip_url: apache-superset==1.5.0 markupsafe==2.0.1
    executable: superset
    settings:
    - name: tables
      kind: array
      description: An array of table names to import into Supserset. They must be in dbt
        format e.g. `model.my_meltano_project.customers`.
    - name: sync_assets
      kind: boolean
      value: false
      description: A boolean whether sync local assets to Superset or not.
    - name: sqlalchemy_uri
      kind: password
      description: The full SQLAlchemy uri for your database engine. Make sure additional
        dependencies are installed to use the particular engine.
    - name: database_name
      description: The alias for your database once imported into Superset.
    - name: additional_dependencies
      kind: array
      description: An array of python dependencies to include as part of startup. A list
        of database driver dependencies can be found here https://superset.apache.org/docs/databases/installing-database-drivers
    - name: load_examples
      kind: boolean
      value: false
      description: A boolean whether to load Superset's example datasets and dashboards.
    commands:
      ui:
        args: analyze/superset/scratch/superset-init.sh
        executable: "/bin/bash"
        container_spec:
          image: apache/superset:1.5.0
          entrypoint: "/app/meltano/docker/superset-init.sh"
          ports:
            '8088': 8088/tcp
          volumes:
          - "$MELTANO_PROJECT_ROOT/analyze/superset/docker:/app/meltano/docker"
          - "$MELTANO_PROJECT_ROOT/analyze/superset/assets:/app/meltano/assets"
          - "$MELTANO_PROJECT_ROOT/.meltano/run/superset/:/app/superset_home"
          - "$MELTANO_PROJECT_ROOT/.meltano/transformers/dbt/target:/app/meltano/dbt/"
          env:
            PATH: "/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            HOME: "/app/superset_home"
            PWD: "/app"
            PYTHONPATH: "/app/pythonpath"
      refresh_datasources:
        args: analyze/superset/refresh_datasources.sh
        executable: "/bin/bash"
environments:
- name: dev
  config:
    plugins:
      extractors:
      - name: tap-csv
        config:
          files:
          - entity: customers
            path: /Users/pnadolny/Documents/Git/GitHub/pnadolny/meltano_example_implementations/meltano_projects/dbt_orchestration/data/customers.csv
            keys:
            - id
          - entity: orders
            path: /Users/pnadolny/Documents/Git/GitHub/pnadolny/meltano_example_implementations/meltano_projects/dbt_orchestration/data/orders.csv
            keys:
            - id
          - entity: payments
            path: /Users/pnadolny/Documents/Git/GitHub/pnadolny/meltano_example_implementations/meltano_projects/dbt_orchestration/data/payments.csv
            keys:
            - id
      loaders:
      - name: target-postgres
        config:
          user: meltano
          dbname: warehouse
          default_target_schema: public
      transformers:
      - name: dbt-postgres
        config:
          host: localhost
          user: meltano
          port: 5432
          dbname: warehouse
          schema: analytics
      utilities:
      - name: superset
        config:
          database_name: my_postgres
          tables:
          - model.my_meltano_project.customers
          - model.my_meltano_project.orders
          sync_assets: true
          additional_dependencies:
          - psycopg2==2.9.3
- name: staging
- name: prod
